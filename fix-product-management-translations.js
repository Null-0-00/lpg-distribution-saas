const fs = require('fs');
const path = require('path');

console.log('üîß Fixing Product Management page translations...');

// First, let's add the missing translation keys to the translations file
const translationsPath = path.join(__dirname, 'src/lib/i18n/translations.ts');
const productManagementPath = path.join(
  __dirname,
  'src/app/dashboard/product-management/page.tsx'
);

// New translation keys needed for product management
const newTranslationKeys = {
  // Product Management specific
  addCompany: 'Add Company',
  addProduct: 'Add Product',
  searchCompanies: 'Search companies...',
  searchProducts: 'Search products...',
  totalProducts: 'Total Products',
  activeProducts: 'Active Products',
  lowStock: 'Low Stock',
  totalStock: 'Total Stock',
  companies: 'Companies',
  productName: 'Product Name',
  cylinderSize: 'Cylinder Size',
  currentPrice: 'Current Price',
  currentStock: 'Current Stock',
  lowStockAlert: 'Low Stock Alert',
  created: 'Created',
  actions: 'Actions',
  active: 'Active',
  inactive: 'Inactive',
  editCompany: 'Edit Company',
  deleteCompany: 'Delete Company',
  editProduct: 'Edit Product',
  deleteProduct: 'Delete Product',
  cylinderSizes: 'Cylinder Sizes',
  full: 'Full',
  empty: 'Empty',
  loading: 'Loading...',
  units: 'units',
  clickToDeactivate: 'Click to deactivate',
  clickToActivate: 'Click to activate',
  product: 'product',
  areYouSureDeleteCompany:
    'Are you sure you want to delete this company? This will also delete all associated products.',
  areYouSureDeleteProduct: 'Are you sure you want to delete this product?',
  areYouSureDeleteCylinderSize:
    'Are you sure you want to delete this cylinder size?',
  failedToSaveCompany: 'Failed to save company',
  failedToSaveProduct: 'Failed to save product',
  failedToDeleteProduct: 'Failed to delete product',
  unknownError: 'Unknown error',
  companyCreatedUpdatedSuccessfully: 'Company created/updated successfully',
  productCreatedUpdatedSuccessfully: 'Product created/updated successfully',
  productDeletedSuccessfully: 'Product deleted successfully',
  refreshingList: 'refreshing list...',
  productListRefreshed: 'Product list refreshed',
  productListRefreshedAfterDeletion: 'Product list refreshed after deletion',
  errorFetchingCompanies: 'Error fetching companies',
  errorFetchingProducts: 'Error fetching products',
  errorFetchingCylinderSizes: 'Error fetching cylinder sizes',
  errorSavingCompany: 'Error saving company',
  errorSavingProduct: 'Error saving product',
  errorDeletingCompany: 'Error deleting company',
  errorDeletingProduct: 'Error deleting product',
  errorDeletingCylinderSize: 'Error deleting cylinder size',
  errorTogglingProductStatus: 'Error toggling product status',
  errorSavingCylinderSize: 'Error saving cylinder size',
};

// Bengali translations for the new keys
const bengaliTranslations = {
  addCompany: '‡¶ï‡ßã‡¶Æ‡ßç‡¶™‡¶æ‡¶®‡¶ø ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®',
  addProduct: '‡¶™‡¶£‡ßç‡¶Ø ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®',
  searchCompanies: '‡¶ï‡ßã‡¶Æ‡ßç‡¶™‡¶æ‡¶®‡¶ø ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®...',
  searchProducts: '‡¶™‡¶£‡ßç‡¶Ø ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®...',
  totalProducts: '‡¶Æ‡ßã‡¶ü ‡¶™‡¶£‡ßç‡¶Ø',
  activeProducts: '‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º ‡¶™‡¶£‡ßç‡¶Ø',
  lowStock: '‡¶ï‡¶Æ ‡¶∏‡ßç‡¶ü‡¶ï',
  totalStock: '‡¶Æ‡ßã‡¶ü ‡¶∏‡ßç‡¶ü‡¶ï',
  companies: '‡¶ï‡ßã‡¶Æ‡ßç‡¶™‡¶æ‡¶®‡¶ø',
  productName: '‡¶™‡¶£‡ßç‡¶Ø‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ',
  cylinderSize: '‡¶∏‡¶ø‡¶≤‡¶ø‡¶®‡ßç‡¶°‡¶æ‡¶∞‡ßá‡¶∞ ‡¶Ü‡¶ï‡¶æ‡¶∞',
  currentPrice: '‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶¶‡¶æ‡¶Æ',
  currentStock: '‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶∏‡ßç‡¶ü‡¶ï',
  lowStockAlert: '‡¶ï‡¶Æ ‡¶∏‡ßç‡¶ü‡¶ï ‡¶∏‡¶§‡¶∞‡ßç‡¶ï‡¶§‡¶æ',
  created: '‡¶§‡ßà‡¶∞‡¶ø',
  actions: '‡¶ï‡¶æ‡¶∞‡ßç‡¶Ø‡¶ï‡ßç‡¶∞‡¶Æ',
  active: '‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º',
  inactive: '‡¶®‡¶ø‡¶∑‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º',
  editCompany: '‡¶ï‡ßã‡¶Æ‡ßç‡¶™‡¶æ‡¶®‡¶ø ‡¶∏‡¶Æ‡ßç‡¶™‡¶æ‡¶¶‡¶®‡¶æ',
  deleteCompany: '‡¶ï‡ßã‡¶Æ‡ßç‡¶™‡¶æ‡¶®‡¶ø ‡¶Æ‡ßÅ‡¶õ‡ßÅ‡¶®',
  editProduct: '‡¶™‡¶£‡ßç‡¶Ø ‡¶∏‡¶Æ‡ßç‡¶™‡¶æ‡¶¶‡¶®‡¶æ',
  deleteProduct: '‡¶™‡¶£‡ßç‡¶Ø ‡¶Æ‡ßÅ‡¶õ‡ßÅ‡¶®',
  cylinderSizes: '‡¶∏‡¶ø‡¶≤‡¶ø‡¶®‡ßç‡¶°‡¶æ‡¶∞‡ßá‡¶∞ ‡¶Ü‡¶ï‡¶æ‡¶∞',
  full: '‡¶™‡ßÇ‡¶∞‡ßç‡¶£',
  empty: '‡¶ñ‡¶æ‡¶≤‡¶ø',
  loading: '‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...',
  units: '‡¶á‡¶â‡¶®‡¶ø‡¶ü',
  clickToDeactivate: '‡¶®‡¶ø‡¶∑‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º ‡¶ï‡¶∞‡¶§‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®',
  clickToActivate: '‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º ‡¶ï‡¶∞‡¶§‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®',
  product: '‡¶™‡¶£‡ßç‡¶Ø',
  areYouSureDeleteCompany:
    '‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶Ø‡ßá ‡¶è‡¶á ‡¶ï‡ßã‡¶Æ‡ßç‡¶™‡¶æ‡¶®‡¶ø‡¶ü‡¶ø ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶§‡ßá ‡¶ö‡¶æ‡¶®? ‡¶è‡¶ü‡¶ø ‡¶∏‡¶Æ‡¶∏‡ßç‡¶§ ‡¶∏‡¶Ç‡¶∂‡ßç‡¶≤‡¶ø‡¶∑‡ßç‡¶ü ‡¶™‡¶£‡ßç‡¶Ø‡¶ì ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶¨‡ßá‡•§',
  areYouSureDeleteProduct: '‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶Ø‡ßá ‡¶è‡¶á ‡¶™‡¶£‡ßç‡¶Ø‡¶ü‡¶ø ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶§‡ßá ‡¶ö‡¶æ‡¶®?',
  areYouSureDeleteCylinderSize:
    '‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶Ø‡ßá ‡¶è‡¶á ‡¶∏‡¶ø‡¶≤‡¶ø‡¶®‡ßç‡¶°‡¶æ‡¶∞‡ßá‡¶∞ ‡¶Ü‡¶ï‡¶æ‡¶∞‡¶ü‡¶ø ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶§‡ßá ‡¶ö‡¶æ‡¶®?',
  failedToSaveCompany: '‡¶ï‡ßã‡¶Æ‡ßç‡¶™‡¶æ‡¶®‡¶ø ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶ï‡¶∞‡¶§‡ßá ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•',
  failedToSaveProduct: '‡¶™‡¶£‡ßç‡¶Ø ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶ï‡¶∞‡¶§‡ßá ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•',
  failedToDeleteProduct: '‡¶™‡¶£‡ßç‡¶Ø ‡¶Æ‡ßÅ‡¶õ‡¶§‡ßá ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•',
  unknownError: '‡¶Ö‡¶ú‡¶æ‡¶®‡¶æ ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø',
  companyCreatedUpdatedSuccessfully: '‡¶ï‡ßã‡¶Æ‡ßç‡¶™‡¶æ‡¶®‡¶ø ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶§‡ßà‡¶∞‡¶ø/‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá',
  productCreatedUpdatedSuccessfully: '‡¶™‡¶£‡ßç‡¶Ø ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶§‡ßà‡¶∞‡¶ø/‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá',
  productDeletedSuccessfully: '‡¶™‡¶£‡ßç‡¶Ø ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá',
  refreshingList: '‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...',
  productListRefreshed: '‡¶™‡¶£‡ßç‡¶Ø‡ßá‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá',
  productListRefreshedAfterDeletion:
    '‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ‡¶∞ ‡¶™‡¶∞ ‡¶™‡¶£‡ßç‡¶Ø‡ßá‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá',
  errorFetchingCompanies: '‡¶ï‡ßã‡¶Æ‡ßç‡¶™‡¶æ‡¶®‡¶ø ‡¶Ü‡¶®‡¶§‡ßá ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø',
  errorFetchingProducts: '‡¶™‡¶£‡ßç‡¶Ø ‡¶Ü‡¶®‡¶§‡ßá ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø',
  errorFetchingCylinderSizes: '‡¶∏‡¶ø‡¶≤‡¶ø‡¶®‡ßç‡¶°‡¶æ‡¶∞‡ßá‡¶∞ ‡¶Ü‡¶ï‡¶æ‡¶∞ ‡¶Ü‡¶®‡¶§‡ßá ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø',
  errorSavingCompany: '‡¶ï‡ßã‡¶Æ‡ßç‡¶™‡¶æ‡¶®‡¶ø ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£‡ßá ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø',
  errorSavingProduct: '‡¶™‡¶£‡ßç‡¶Ø ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£‡ßá ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø',
  errorDeletingCompany: '‡¶ï‡ßã‡¶Æ‡ßç‡¶™‡¶æ‡¶®‡¶ø ‡¶Æ‡ßÅ‡¶õ‡¶§‡ßá ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø',
  errorDeletingProduct: '‡¶™‡¶£‡ßç‡¶Ø ‡¶Æ‡ßÅ‡¶õ‡¶§‡ßá ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø',
  errorDeletingCylinderSize: '‡¶∏‡¶ø‡¶≤‡¶ø‡¶®‡ßç‡¶°‡¶æ‡¶∞‡ßá‡¶∞ ‡¶Ü‡¶ï‡¶æ‡¶∞ ‡¶Æ‡ßÅ‡¶õ‡¶§‡ßá ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø',
  errorTogglingProductStatus: '‡¶™‡¶£‡ßç‡¶Ø‡ßá‡¶∞ ‡¶∏‡ßç‡¶•‡¶ø‡¶§‡¶ø ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®‡ßá ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø',
  errorSavingCylinderSize: '‡¶∏‡¶ø‡¶≤‡¶ø‡¶®‡ßç‡¶°‡¶æ‡¶∞‡ßá‡¶∞ ‡¶Ü‡¶ï‡¶æ‡¶∞ ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£‡ßá ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø',
};

console.log('üìñ Reading translations file...');
let translationsContent = fs.readFileSync(translationsPath, 'utf8');

// Add new keys to English translations
console.log('‚ûï Adding new translation keys to English section...');
const englishTranslationsEndPattern =
  /(\s+\/\/ All missing translation keys - English[\s\S]*?)(\n\s*};)/;
const englishMatch = translationsContent.match(englishTranslationsEndPattern);

if (englishMatch) {
  let newEnglishKeys = '';
  Object.entries(newTranslationKeys).forEach(([key, value]) => {
    newEnglishKeys += `  ${key}: '${value}',\n`;
  });

  translationsContent = translationsContent.replace(
    englishTranslationsEndPattern,
    `$1\n  // Product Management translations\n${newEnglishKeys}$2`
  );
} else {
  // If the pattern doesn't match, add before the closing brace of englishTranslations
  const englishEndPattern =
    /(const englishTranslations: Translations = \{[\s\S]*?)(\n};)/;
  const englishEndMatch = translationsContent.match(englishEndPattern);

  if (englishEndMatch) {
    let newEnglishKeys = '';
    Object.entries(newTranslationKeys).forEach(([key, value]) => {
      newEnglishKeys += `  ${key}: '${value}',\n`;
    });

    translationsContent = translationsContent.replace(
      englishEndPattern,
      `$1\n  // Product Management translations\n${newEnglishKeys}$2`
    );
  }
}

// Add new keys to Bengali translations
console.log('‚ûï Adding new translation keys to Bengali section...');
const bengaliTranslationsEndPattern =
  /(const bengaliTranslations: Translations = \{[\s\S]*?)(\n};)/;
const bengaliMatch = translationsContent.match(bengaliTranslationsEndPattern);

if (bengaliMatch) {
  let newBengaliKeys = '';
  Object.entries(bengaliTranslations).forEach(([key, value]) => {
    newBengaliKeys += `  ${key}: '${value}',\n`;
  });

  translationsContent = translationsContent.replace(
    bengaliTranslationsEndPattern,
    `$1\n  // Product Management translations\n${newBengaliKeys}$2`
  );
}

// Write updated translations file
console.log('üíæ Writing updated translations file...');
fs.writeFileSync(translationsPath, translationsContent);

console.log('üìù Updating Product Management page component...');
let pageContent = fs.readFileSync(productManagementPath, 'utf8');

// Replace hardcoded strings with translation calls
const replacements = [
  // Tab labels
  [
    "{ id: 'cylinder-sizes', label: 'Cylinder Sizes', icon: Settings }",
    "{ id: 'cylinder-sizes', label: t('cylinderSizes'), icon: Settings }",
  ],

  // Placeholders
  ['placeholder="Search companies..."', 'placeholder={t("searchCompanies")}'],
  ['placeholder="Search products..."', 'placeholder={t("searchProducts")}'],

  // Button texts
  ['<span>Add Company</span>', '<span>{t("addCompany")}</span>'],
  ['<span>Add Product</span>', '<span>{t("addProduct")}</span>'],

  // Table headers
  ['Product Name', '{t("productName")}'],
  ['Cylinder Size', '{t("cylinderSize")}'],
  ['Current Price', '{t("currentPrice")}'],
  ['Current Stock', '{t("currentStock")}'],
  ['Low Stock Alert', '{t("lowStockAlert")}'],
  ['Created', '{t("created")}'],
  ['Actions', '{t("actions")}'],

  // Stats labels
  ['Total Products', '{t("totalProducts")}'],
  ['Active Products', '{t("activeProducts")}'],
  ['Low Stock', '{t("lowStock")}'],
  ['Total Stock', '{t("totalStock")}'],
  ['Companies', '{t("companies")}'],

  // Status texts
  [
    "{product.isActive ? 'Active' : 'Inactive'}",
    '{product.isActive ? t("active") : t("inactive")}',
  ],

  // Tooltips
  ['title="Edit Company"', 'title={t("editCompany")}'],
  ['title="Delete Company"', 'title={t("deleteCompany")}'],
  ['title="Edit Product"', 'title={t("editProduct")}'],
  ['title="Delete Product"', 'title={t("deleteProduct")}'],

  // Stock display
  [
    '{product.inventory.fullCylinders} Full',
    '{product.inventory.fullCylinders} {t("full")}',
  ],
  [
    '{product.inventory.emptyCylinders} Empty',
    '{product.inventory.emptyCylinders} {t("empty")}',
  ],
  ['Loading...', '{t("loading")}'],
  [
    '`${product.lowStockThreshold} units`',
    '`${product.lowStockThreshold} ${t("units")}`',
  ],

  // Confirmation messages
  [
    "'Are you sure you want to delete this company? This will also delete all associated products.'",
    't("areYouSureDeleteCompany")',
  ],
  [
    "'Are you sure you want to delete this product?'",
    't("areYouSureDeleteProduct")',
  ],
  [
    "'Are you sure you want to delete this cylinder size?'",
    't("areYouSureDeleteCylinderSize")',
  ],

  // Error messages
  [
    "`Failed to save company: ${errorData.error || 'Unknown error'}`",
    '`${t("failedToSaveCompany")}: ${errorData.error || t("unknownError")}`',
  ],
  [
    "`Failed to save product: ${errorData.error || 'Unknown error'}`",
    '`${t("failedToSaveProduct")}: ${errorData.error || t("unknownError")}`',
  ],
  [
    "`Failed to delete product: ${errorData.error || 'Unknown error'}`",
    '`${t("failedToDeleteProduct")}: ${errorData.error || t("unknownError")}`',
  ],

  // Click to activate/deactivate tooltip
  [
    "`Click to ${product.isActive ? 'deactivate' : 'activate'} product`",
    '`${product.isActive ? t("clickToDeactivate") : t("clickToActivate")} ${t("product")}`',
  ],
];

// Apply replacements
replacements.forEach(([search, replace]) => {
  if (pageContent.includes(search)) {
    pageContent = pageContent.replace(
      new RegExp(search.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g'),
      replace
    );
    console.log(`‚úÖ Replaced: ${search.substring(0, 50)}...`);
  }
});

// Write updated page content
fs.writeFileSync(productManagementPath, pageContent);

console.log('\nüéâ Product Management translations fixed successfully!');
console.log('‚ú® The page should now display properly in Bengali.');
console.log(
  `üìä Added ${Object.keys(newTranslationKeys).length} new translation keys.`
);

console.log('\nüìã Summary of changes:');
console.log('‚úÖ Added translation keys for buttons, labels, and messages');
console.log('‚úÖ Replaced hardcoded English text with translation calls');
console.log('‚úÖ Added proper Bengali translations for all UI elements');
console.log('‚úÖ Fixed table headers, status indicators, and tooltips');
console.log('‚úÖ Localized error messages and confirmation dialogs');
